# é¡¹ç›®é…ç½®

## å®‰è£…ä¾èµ–

```bash
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash

nvm install
nvm alias default 24
nvm use

npm install

npm update && npm ci
```

## é…ç½®æ–‡ä»¶

æ‚¨å¯ä»¥åœ¨ `package.json` ä¸­ä¿®æ”¹æˆ–æ·»åŠ é¢å¤–çš„è„šæœ¬ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›é¢„ç½®çš„è„šæœ¬å‘½ä»¤ï¼š

### è°ƒè¯•é¡¹ç›®

ğŸš€ **ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨é¡¹ç›®è°ƒè¯•** ğŸš€ï¼š

```bash
npm start
```

ç¨‹åºä¼šè¿è¡Œåœ¨ï¼š [localhost:8000](http://localhost:8000/)

### æ£€æŸ¥ä»£ç æ ¼å¼

```bash
npm run lint
```

### æ£€æŸ¥å¹¶è‡ªåŠ¨ä¿®å¤ä»£ç æ ¼å¼

```bash
npm run lint:fix
```

### æµ‹è¯•ä»£ç 

```bash
# å…¨é‡é—¨ç¦ï¼ˆunit + integrationï¼ŒCI é£æ ¼ runnerï¼‰
npm test

# èšç„¦å¥—ä»¶ï¼ˆåŠŸèƒ½å¼€å‘æ¨èï¼‰
npm run test:ci -- tests/integration/<feature>/ --runInBand --testTimeout=20000 --no-coverage
```

### æµ‹è¯•è¦†ç›–ç‡åˆ†æ

é¡¹ç›®æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„æµ‹è¯•è¦†ç›–ç‡åˆ†æè„šæœ¬ (`scripts/test-coverage-report.js`)ï¼Œå¯ä»¥è¯¦ç»†åˆ†ææµ‹è¯•è¦†ç›–æƒ…å†µã€‚

#### å¿«é€Ÿä½¿ç”¨

```bash
# æ¨èï¼šè¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¯¦ç»†è¦†ç›–ç‡æŠ¥å‘Š
npm run test:report

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¯¦ç»†è¦†ç›–ç‡æŠ¥å‘Šï¼ˆåŒä¸Šï¼‰
npm run test:coverage:report

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆæ ‡å‡†è¦†ç›–ç‡æ•°æ®ï¼ˆHTMLæ ¼å¼ï¼‰
npm run test:coverage
```

#### è¦†ç›–ç‡é…ç½®è¯´æ˜

æµ‹è¯•è¦†ç›–ç‡çš„é…ç½®åœ¨ `jest.config.cjs` æ–‡ä»¶ä¸­ï¼Œä»¥ä¸‹æ–‡ä»¶ç±»å‹ä¼šè¢«æ’é™¤åœ¨è¦†ç›–ç‡ç»Ÿè®¡ä¹‹å¤–ï¼š

- `.d.ts` ç±»å‹å£°æ˜æ–‡ä»¶
- `.umi` ç›¸å…³æ„å»ºæ–‡ä»¶
- `typings.d.ts` ç±»å‹å®šä¹‰æ–‡ä»¶
- `service-worker.js` Service Worker æ–‡ä»¶
- `*.test.{ts,tsx,js,jsx}` å’Œ `*.spec.{ts,tsx,js,jsx}` æµ‹è¯•æ–‡ä»¶
- `src/components/index.ts`, `src/locales/en-US.ts`, `src/locales/zh-CN.ts` ç®€å•çš„é‡å¯¼å‡ºæ–‡ä»¶
- `src/services/**/data.ts` æœåŠ¡ç±»å‹å®šä¹‰æ–‡ä»¶

> **æ³¨æ„**: è¦†ç›–ç‡æŠ¥å‘Šè„šæœ¬ä¸ Jest é…ç½®ä¿æŒä¸€è‡´ï¼Œç¡®ä¿ç»Ÿè®¡çš„å‡†ç¡®æ€§ã€‚

#### è¦†ç›–ç‡ç­‰çº§è¯´æ˜

| å›¾æ ‡ | é¢œè‰² | è¦†ç›–ç‡èŒƒå›´ | è¯´æ˜               |
| ---- | ---- | ---------- | ------------------ |
| âœ…   | ç»¿è‰² | 100%       | å®Œç¾è¦†ç›–           |
| ğŸŸ¢   | é’è‰² | 80-99%     | è‰¯å¥½è¦†ç›–           |
| ğŸŸ¡   | é»„è‰² | 50-79%     | ä¸­ç­‰è¦†ç›–           |
| ğŸ”´   | çº¢è‰² | < 50%      | ä½è¦†ç›–ç‡ï¼Œéœ€è¦æ”¹è¿› |

#### è¦†ç›–ç‡æŒ‡æ ‡

æŠ¥å‘Šæ˜¾ç¤ºä¸‰ç§è¦†ç›–ç‡æŒ‡æ ‡ï¼š

1. **è¡Œè¦†ç›–ç‡ï¼ˆLinesï¼‰**ï¼šè¢«æµ‹è¯•æ‰§è¡Œçš„ä»£ç è¡Œç™¾åˆ†æ¯”
2. **åˆ†æ”¯è¦†ç›–ç‡ï¼ˆBranchesï¼‰**ï¼šè¢«æµ‹è¯•æ‰§è¡Œçš„æ¡ä»¶åˆ†æ”¯ç™¾åˆ†æ¯”
3. **å‡½æ•°è¦†ç›–ç‡ï¼ˆFunctionsï¼‰**ï¼šè¢«æµ‹è¯•è°ƒç”¨çš„å‡½æ•°ç™¾åˆ†æ¯”

#### æŠ¥å‘Šç»“æ„

è¦†ç›–ç‡æŠ¥å‘ŠæŒ‰ç…§ä»¥ä¸‹æ–¹å¼åˆ†ç±»æ˜¾ç¤ºï¼š

```
ğŸ“¦ Components    - React ç»„ä»¶
ğŸ”§ Services      - æœåŠ¡å’Œå·¥å…·å‡½æ•°
ğŸ“„ Pages         - é¡µé¢ç»„ä»¶
ğŸ“ Others        - å…¶ä»–æ–‡ä»¶ï¼ˆé…ç½®ã€å›½é™…åŒ–ç­‰ï¼‰
```

æ¯ä¸ªåˆ†ç±»éƒ½ä¼šæ˜¾ç¤ºï¼š

- âŒ æ— æµ‹è¯•è¦†ç›–çš„æ–‡ä»¶åˆ—è¡¨
- ğŸ“Š æœ‰æµ‹è¯•è¦†ç›–çš„æ–‡ä»¶è¯¦æƒ…ï¼ˆåŒ…æ‹¬ä¸‰ç§è¦†ç›–ç‡æŒ‡æ ‡ï¼‰
- ğŸ“ˆ è¯¥åˆ†ç±»çš„ç»Ÿè®¡ä¿¡æ¯

#### æµ‹è¯•æ–‡ä»¶ä½ç½®

- ç»„ä»¶æµ‹è¯•ï¼š`tests/unit/components/`
- æœåŠ¡æµ‹è¯•ï¼š`tests/unit/services/`
- é¡µé¢æµ‹è¯•ï¼š`tests/unit/pages/`

#### ç¼–å†™æµ‹è¯•çš„å»ºè®®

1. ä½¿ç”¨ `@testing-library/react` è¿›è¡Œç»„ä»¶æµ‹è¯•
2. Mock å¤–éƒ¨ä¾èµ–ï¼ˆAPIã€è·¯ç”±ç­‰ï¼‰
3. æµ‹è¯•ä¸åŒçš„ç”¨æˆ·äº¤äº’åœºæ™¯
4. æµ‹è¯•è¾¹ç•Œæƒ…å†µå’Œé”™è¯¯å¤„ç†
5. æµ‹è¯•ä¸åŒçš„ props ç»„åˆ

#### æµ‹è¯•ç›¸å…³å‘½ä»¤

| å‘½ä»¤                           | è¯´æ˜                           |
| ------------------------------ | ------------------------------ |
| `npm test`                     | è¿è¡Œæ‰€æœ‰æµ‹è¯•                   |
| `npm run test:ci -- <args>`    | ä¼ å…¥æ˜ç¡® Jest å‚æ•°æ‰§è¡Œèšç„¦å¥—ä»¶ |
| `npm run test:coverage`        | è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æ•°æ®       |
| `npm run test:coverage:report` | ç”Ÿæˆå¯è¯»çš„è¦†ç›–ç‡æŠ¥å‘Š           |
| `npm run test:report`          | è¿è¡Œæµ‹è¯•å¹¶ç”ŸæˆæŠ¥å‘Šï¼ˆç»„åˆå‘½ä»¤ï¼‰ |
| `npm run test:update`          | æ›´æ–°æµ‹è¯•å¿«ç…§                   |

> ğŸ’¡ **æç¤º**ï¼šè¦†ç›–ç‡æŠ¥å‘Šå®ç°è„šæœ¬ä½äº [`scripts/test-coverage-report.js`](./scripts/test-coverage-report.js)

### æ„å»ºé¡¹ç›®

```bash
npm run build
```

## è‡ªåŠ¨å‘å¸ƒ

é¡¹ç›®çš„ .github/workflows/build.yml æ–‡ä»¶ä¸­é…ç½®äº†åŸºäº tag çš„è‡ªåŠ¨å‘å¸ƒæµç¨‹ï¼Œåªéœ€åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªç¬¦åˆ'v\*'æ ¼å¼çš„ tag å¹¶æ¨é€åˆ°è¿œç¨‹ä»“åº“å³å¯è§¦å‘å‘å¸ƒã€‚é€šè¿‡åœ¨é¡¹ç›®ä¸­é…ç½®å¯†é’¥ CLOUDFLARE_API_TOKEN å’Œ CLOUDFLARE_ACCOUNT_IDï¼Œå³å¯å®ç°è‡ªåŠ¨éƒ¨ç½²åˆ° Cloudflare Pagesã€‚

```bash
# åˆ—å‡ºå·²æœ‰æ ‡ç­¾
git tag

# åˆ›å»ºä¸€ä¸ªæ–°çš„æ ‡ç­¾
git tag v0.0.1

# å°†è¯¥æ ‡ç­¾æ¨é€åˆ°è¿œç¨‹
git push origin v0.0.1
```
